From: Valentine Fatiev <valentinef@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/nvme/host/nvfs-dma.h

Change-Id: Id9e8f89b4daf48524898f4243582bbf0ee1d7157
---
 drivers/nvme/host/nvfs-dma.h | 4 ++++
 1 file changed, 4 insertions(+)

--- a/drivers/nvme/host/nvfs-dma.h
+++ b/drivers/nvme/host/nvfs-dma.h
@@ -21,7 +21,9 @@ static bool nvme_nvfs_unmap_data(struct
 		return false;
         if (iod->sg && !is_pci_p2pdma_page(sg_page(iod->sg)) &&
             !blk_integrity_rq(req) &&
+#if defined(HAVE_BLKDEV_DMA_MAP_BVEC) && defined(HAVE_BLKDEV_REQ_BVEC)
             !iod->dma_len &&
+#endif
             nvfs_ops != NULL) {
                 int count;
                 count = nvfs_ops->nvfs_dma_unmap_sg(dev->dev, iod->sg, iod->nents,
@@ -49,7 +51,9 @@ static blk_status_t nvme_nvfs_map_data(s
        *is_nvfs_io = false;
 
        if (!blk_integrity_rq(req) && nvfs_get_ops()) {
+#if defined(HAVE_BLKDEV_DMA_MAP_BVEC) && defined(HAVE_BLKDEV_REQ_BVEC)
                 iod->dma_len = 0;
+#endif
                 iod->sg = mempool_alloc(dev->iod_mempool, GFP_ATOMIC);
                 if (!iod->sg) {
                         nvfs_put_ops();
