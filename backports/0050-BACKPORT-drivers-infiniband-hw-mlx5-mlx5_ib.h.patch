From: Valentine Fatiev <valentinef@mellanox.com>
Subject: [PATCH] BACKPORT: drivers/infiniband/hw/mlx5/mlx5_ib.h

Change-Id: If15fa5c59db4feb4f4201c13c6e60e4d47a9beb8
---
 drivers/infiniband/hw/mlx5/mlx5_ib.h | 13 +++++++++++++
 1 file changed, 13 insertions(+)

--- a/drivers/infiniband/hw/mlx5/mlx5_ib.h
+++ b/drivers/infiniband/hw/mlx5/mlx5_ib.h
@@ -1297,6 +1297,10 @@ int mlx5_ib_odp_init_one(struct mlx5_ib_
 void mlx5_ib_odp_cleanup_one(struct mlx5_ib_dev *ibdev);
 int __init mlx5_ib_odp_init(void);
 void mlx5_ib_odp_cleanup(void);
+#ifndef HAVE_MMU_INTERVAL_NOTIFIER
+void mlx5_ib_invalidate_range(struct ib_umem_odp *umem_odp, unsigned long start,
+			      unsigned long end);
+#endif
 void mlx5_odp_init_mr_cache_entry(struct mlx5_cache_ent *ent);
 void mlx5_odp_populate_xlt(void *xlt, size_t idx, size_t nentries,
 			   struct mlx5_ib_mr *mr, int flags);
@@ -1325,10 +1329,17 @@ mlx5_ib_advise_mr_prefetch(struct ib_pd
 {
 	return -EOPNOTSUPP;
 }
+#ifndef HAVE_MMU_INTERVAL_NOTIFIER
+static inline void mlx5_ib_invalidate_range(struct ib_umem_odp *umem_odp,
+					    unsigned long start,
+					    unsigned long end){};
+#endif
 #endif /* CONFIG_INFINIBAND_ON_DEMAND_PAGING */
 
+#ifdef HAVE_MMU_INTERVAL_NOTIFIER
 extern const struct mmu_interval_notifier_ops mlx5_mn_ops;
 
+#endif
 /* Needed for rep profile */
 void __mlx5_ib_remove(struct mlx5_ib_dev *dev,
 		      const struct mlx5_ib_profile *profile,
@@ -1336,6 +1347,7 @@ void __mlx5_ib_remove(struct mlx5_ib_dev
 void *__mlx5_ib_add(struct mlx5_ib_dev *dev,
 		    const struct mlx5_ib_profile *profile);
 
+#ifdef HAVE_NDO_SET_VF_MAC
 int mlx5_ib_get_vf_config(struct ib_device *device, int vf,
 			  u8 port, struct ifla_vf_info *info);
 int mlx5_ib_set_vf_link_state(struct ib_device *device, int vf,
@@ -1347,6 +1359,7 @@ int mlx5_ib_get_vf_guid(struct ib_device
 			struct ifla_vf_guid *port_guid);
 int mlx5_ib_set_vf_guid(struct ib_device *device, int vf, u8 port,
 			u64 guid, int type);
+#endif
 
 __be16 mlx5_get_roce_udp_sport_min(const struct mlx5_ib_dev *dev,
 				   const struct ib_gid_attr *attr);
