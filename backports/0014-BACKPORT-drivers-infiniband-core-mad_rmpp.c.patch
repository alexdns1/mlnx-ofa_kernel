From: Valentine Fatiev <valentinef@mellanox.com>
Subject: [PATCH] BACKPORT: drivers/infiniband/core/mad_rmpp.c

Change-Id: Icc4ac615c00060d4559cb2ada2c874b98213c985
---
 drivers/infiniband/core/mad_rmpp.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

--- a/drivers/infiniband/core/mad_rmpp.c
+++ b/drivers/infiniband/core/mad_rmpp.c
@@ -99,8 +99,13 @@ void ib_cancel_rmpp_recvs(struct ib_mad_
 	spin_unlock_irqrestore(&agent->lock, flags);
 
 	list_for_each_entry(rmpp_recv, &agent->rmpp_list, list) {
-		cancel_delayed_work(&rmpp_recv->timeout_work);
-		cancel_delayed_work(&rmpp_recv->cleanup_work);
+#ifdef HAVE___CANCEL_DELAYED_WORK
+		__cancel_delayed_work(&rmpp_recv->timeout_work);
+		__cancel_delayed_work(&rmpp_recv->cleanup_work);
+#else
+       	cancel_delayed_work(&rmpp_recv->timeout_work);
+       	cancel_delayed_work(&rmpp_recv->cleanup_work);
+#endif
 	}
 
 	flush_workqueue(agent->qp_info->port_priv->wq);
