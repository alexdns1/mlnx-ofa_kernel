From: Alaa Hleihel <alaa@mellanox.com>
Subject: [PATCH] BACKPORT: include/linux/mlx5/driver.h

Change-Id: I32a10351bbc548039580e8fcf684f874763385c1
---
 include/linux/mlx5/driver.h | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

--- a/include/linux/mlx5/driver.h
+++ b/include/linux/mlx5/driver.h
@@ -51,8 +51,14 @@
 #include <linux/mlx5/doorbell.h>
 #include <linux/mlx5/srq.h>
 #include <linux/net_tstamp.h>
+#ifdef HAVE_TIMECOUNTER_H
 #include <linux/timecounter.h>
+#else
+#include <linux/clocksource.h>
+#endif
+#if defined (HAVE_PTP_CLOCK_INFO) && (defined(CONFIG_PTP_1588_CLOCK) || defined(CONFIG_PTP_1588_CLOCK_MODULE))
 #include <linux/ptp_clock_kernel.h>
+#endif
 
 enum {
 	MLX5_BOARD_ID_LEN = 64,
@@ -715,6 +721,10 @@ struct mlx5_priv {
 	struct dentry	       *dct_debugfs;
 	/* end: dct stuff */
 
+#ifndef HAVE_DEVLINK_H
+	struct dentry	       *compat_debugfs;
+#endif
+
 	/* start: cq staff */
 	struct mlx5_cq_table	cq_table;
 	/* end: cq staff */
@@ -882,9 +892,13 @@ struct mlx5_clock {
 	unsigned long              overflow_period;
 	struct delayed_work        overflow_work;
 	struct mlx5_core_dev      *mdev;
+#if defined (HAVE_PTP_CLOCK_INFO) && (defined (CONFIG_PTP_1588_CLOCK) || defined(CONFIG_PTP_1588_CLOCK_MODULE))
 	struct ptp_clock          *ptp;
 	struct ptp_clock_info      ptp_info;
+#ifdef HAVE_PTP_CLOCK_INFO_N_PINS
 	struct mlx5_pps            pps_info;
+#endif
+#endif
 };
 
 struct ecpu_params {
@@ -998,8 +1012,13 @@ struct mlx5_cmd_work_ent {
 	int			page_queue;
 	u8			status;
 	u8			token;
+#ifdef HAVE_KTIME_GET_NS
 	u64			ts1;
 	u64			ts2;
+#else
+	struct timespec		ts1;
+	struct timespec		ts2;
+#endif
 	u16			op;
 	bool			polling;
 };
