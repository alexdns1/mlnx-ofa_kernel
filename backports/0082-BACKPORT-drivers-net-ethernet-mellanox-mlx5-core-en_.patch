From: Mikhael Goikhman <migo@mellanox.com>
Subject: [PATCH] BACKPORT:
 drivers/net/ethernet/mellanox/mlx5/core/en_accel/en_accel.h

Change-Id: I2a4203bf32a885d841bff103ee74b33b5b279730
---
 drivers/net/ethernet/mellanox/mlx5/core/en_accel/en_accel.h | 6 ++++++
 1 file changed, 6 insertions(+)

--- a/drivers/net/ethernet/mellanox/mlx5/core/en_accel/en_accel.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_accel/en_accel.h
@@ -114,8 +114,10 @@ static inline bool mlx5e_accel_tx_begin(
 					struct sk_buff *skb,
 					struct mlx5e_accel_tx_state *state)
 {
+#ifdef HAVE_NETIF_F_GSO_UDP_L4
 	if (skb_is_gso(skb) && skb_shinfo(skb)->gso_type & SKB_GSO_UDP_L4)
 		mlx5e_udp_gso_handle_tx_skb(skb);
+#endif
 
 #ifdef CONFIG_MLX5_EN_TLS
 	if (test_bit(MLX5E_SQ_STATE_TLS, &sq->state)) {
@@ -151,7 +153,11 @@ static inline bool mlx5e_accel_tx_finish
 
 static inline int mlx5e_accel_sk_get_rxq(struct sock *sk)
 {
+#ifdef HAVE_SK_RX_QUEUE_GET
 	int rxq = sk_rx_queue_get(sk);
+#else
+	int rxq = -1;
+#endif
 
 	if (unlikely(rxq == -1))
 		rxq = 0;
