From: Neta Ostrovsky <netao@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/net/ethernet/mellanox/mlx5/core/mlx5_devm.c

Change-Id: I482978c87c117386b097d98a62a2b4eb5a7b27f8
---
 drivers/net/ethernet/mellanox/mlx5/core/mlx5_devm.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

--- a/drivers/net/ethernet/mellanox/mlx5/core/mlx5_devm.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/mlx5_devm.c
@@ -1,6 +1,5 @@
 // SPDX-License-Identifier: GPL-2.0 OR Linux-OpenIB
 /* Copyright (c) 2021 Mellanox Technologies Ltd. */
-
 #include <linux/log2.h>
 #include "mlx5_core.h"
 #include "fs_core.h"
@@ -176,7 +175,11 @@ int mlx5_devm_sf_port_fn_hw_addr_get(str
 	memset(&devport, 0, sizeof(devport));
 	devport.devlink = devlink;
 	devport.index = port->index;
+#ifdef HAVE_PORT_FUNCTION_HW_ADDR_GET_GET_4_PARAM
+	return mlx5_devlink_port_function_hw_addr_get(&devport,
+#else
 	return mlx5_devlink_port_function_hw_addr_get(devlink, &devport,
+#endif
 						      hw_addr, hw_addr_len, extack);
 }
 
@@ -207,7 +210,11 @@ int mlx5_devm_sf_port_fn_hw_addr_set(str
 	memset(&devport, 0, sizeof(devport));
 	devport.devlink = devlink;
 	devport.index = port->index;
+#ifdef HAVE_PORT_FUNCTION_HW_ADDR_GET_GET_4_PARAM
+	return mlx5_devlink_port_function_hw_addr_set(&devport, hw_addr,
+#else
 	return mlx5_devlink_port_function_hw_addr_set(devlink, &devport, hw_addr,
+#endif
 						      hw_addr_len, extack);
 }
 
@@ -609,3 +616,4 @@ void mlx5_devm_unregister(struct mlx5_co
 	mutex_unlock(&mlx5_mlxdevm_mutex);
 	kfree(mdevm);
 }
+
